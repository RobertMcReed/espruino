/*
// SETUP
// IR Receiver
//   Put Pin One (data) in B4
//   Put Pin Two (ground) in B3 (we will set this pin to ground manually)
//   Put Pin Three (power) in 3.3v
//   With the ir receiver in place as described, the round part should be facing the board

var rxDATA = B4;
var rxGROUND = B3;
digitalWrite(rxGROUND, 0);
pinMode(rxDATA, "input_pullup");

var signal = [];
var currentWatch;

setWatch(function(e) {
  if (!signal.length) {
    setTimeout(() => {
      signal.shift();
      console.log(signal.toString());
      signal = [];
    }, 1000);
  }

  signal.push((1000*(e.time - e.lastTime)).toFixed(1));
}, rxDATA, {edge:"both",repeat:true});

/*
// SETUP
// IR Transmitter
//   Put the short leg (cathode) into A5
//   Put the long leg (anode) into A6

var IR_ANODE = A6;
var IR_CATHODE = A5;

// SETUP
// LED
//   Put the short lef (cathode) into B5
//   Put the long leg (anode) into B6

var LED_ANODE = B6;
var LED_CATHODE = B5;
var RED = LED1;
var GREEN = LED2;
var LED = LED_ANODE;
analogWrite(LED_CATHODE, 0);
digitalWrite(LED, 0);

function transmit(signal) {
  digitalWrite(LED, 1);
  analogWrite(IR_CATHODE, 0.9, { freq: 38000 });
  digitalPulse(IR_ANODE, 1, signal);
  digitalPulse(IR_ANODE, 1, 0);
  digitalWrite(LED, 0);
}
*/



var VOL_UP = [2.4,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,26.7,2.4,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.5,0.6,0.6,0.6,0.6,0.6,0.6,1.2,26.7,2.4,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.5,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.5,1.2];

var VOL_DOWN = [2.4,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.5,0.6,0.6,0.6,0.6,1.2,26.0,2.4,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,26.1,2.4,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.5,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2];

var VOL_MUTE = [2.4,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,26.7,2.4,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,26.6,2.4,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2];

var SET_V1 = [     [2.4,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,26.6,2.4,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,26.6,2.4,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.5,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,136.1,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,26.1,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.5,0.6,26.0,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,136.1,2.4,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.5,0.6,25.5,2.4,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,25.5,2.4,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.5,0.6,136.1,2.4,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,24.3,2.4,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,24.3,2.4,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,136.1,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2],[1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,27.2,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,27.2,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6]];

var SET_TV = [[2.4,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,25.5,2.4,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,25.4,2.4,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,0.5,0.6,0.6,0.6,0.6,1.2,136.0,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,26.1,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.5,0.6,26.0,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,136.1,2.4,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,25.4,2.4,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,25.5,2.4,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,136.1,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.5,0.6,0.6,0.6,26.1,2.4,0.6,0.6,0.5,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,26.0,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,136.1,2.4,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6], [0.6,0.6,0.6,0.6,0.6,26.6,2.4,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,26.7,2.4,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6]];

var SET_CD = [2.4,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.5,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.5,1.2,26.1,2.4,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,26.1,2.4,0.6,1.2,0.5,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2];

var SET_PH = [2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,27.2,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,27.3,2.4,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2];

var CTL_PWR = [[2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,21.3,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,21.3,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,136.0,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,24.9,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,24.9,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,1.2,136.1,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,24.9,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,24.9,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,136.1,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,24.9,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,24.9,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,0.6,136.1,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6],[0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,23.7,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,23.7,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,136.1,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.5,1.2,0.6,0.6,0.6,1.2,0.6,0.6,23.7,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.5,1.2,0.6,0.6,0.6,1.2,0.5,0.6,23.7,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,136.1,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,24.3,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,24.3,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,0.6,136.1,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,18.3,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,18.3,2.4,0.6,1.2,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2,0.6,1.2,0.6,0.6,0.6,1.2]];

var busy;

const blastIR = (code) => {
  if (busy) {
    digitalPulse(LED1, 1, [100,100,100,100,100]);
    return;
  }

  busy = true;
  LED2.toggle();
  Puck.IR(code);
  setTimeout(() => {
    LED2.toggle();
    busy = false;
  }, 1000);
};

const handlePress = (e) => {
  const time = e.time - e.lastTime;

  blastIR(SET_CD);
};

setWatch(handlePress, BTN, { edge: 'rising', repeat: true, debounce: 50 });
